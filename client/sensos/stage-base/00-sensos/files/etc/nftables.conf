#!/usr/sbin/nft -f

table inet filter {
  set wg_ports {
    type inet_service
    flags interval
    elements = {}   # empty at build time
  }

  chain input {
    type filter hook input priority 0;

    iif lo accept
    ct state established,related accept

    ip protocol icmp accept
    ip6 nexthdr icmpv6 accept

    tcp dport 22 accept

    # Allow any WireGuard ports present in the set
    udp dport @wg_ports accept

    drop
  }

  chain forward { type filter hook forward priority 0; drop; }
  chain output  { type filter hook output  priority 0; accept; }
}

# Optional: load per-host fragments last
include "/etc/nftables.d/*.nft"
